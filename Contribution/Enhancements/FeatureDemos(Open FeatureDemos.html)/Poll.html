<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Poll Demo (A/B/C/D + Reset)</title>

  <!-- Reveal.js via CDN (optional; the poll still works without it) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/black.min.css" id="theme">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/monokai.min.css">

  <style>
    :root{
      --bg: #111; --fg: #fff; --border:#444;
    }
    .poll { display: grid; gap: 10px; }
    .poll-controls { display:flex; flex-wrap: wrap; gap: 8px; align-items:center; }
    .poll button {
      padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border);
      background: var(--bg); color: var(--fg); cursor: pointer;
    }
    .poll button:focus-visible { outline: 2px solid #66f; outline-offset: 2px; }
    .poll-chart {
      width: 100%; height: 240px; min-height: 200px;
      background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      display:block;
    }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h2>Live Poll (Local)</h2>
        <p>Click a button to vote. Use Reset to clear the poll.</p>

        <div class="poll">
          <div class="poll-controls">
            <button data-choice="A">A</button>
            <button data-choice="B">B</button>
            <button data-choice="C">C</button>
            <button data-choice="D">D</button>
            <button id="resetPoll" title="Reset poll">Reset</button>
          </div>
          <canvas id="pollChart" class="poll-chart" aria-label="Bar chart of poll results" role="img"></canvas>
        </div>
      </section>
    </div>
  </div>

  <!-- Reveal.js scripts via CDN (safe to fail) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/markdown/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.min.js"></script>

  <script>
    // Initialize Reveal if available (don’t crash if offline/CDN blocked)
    try {
      if (window.Reveal) {
        Reveal.initialize({
          controls: true,
          progress: true,
          slideNumber: 'c/t',
          hash: true,
          plugins: [ window.RevealMarkdown || {}, window.RevealHighlight || {}, window.RevealNotes || {} ]
        });
      }
    } catch (e) {
      console.warn('Reveal failed to initialize (offline?):', e);
    }

    (function(){
      const pollCanvas = document.getElementById('pollChart');
      const ctx = pollCanvas.getContext('2d');
      if (!ctx) { console.error('Canvas 2D context unavailable'); return; }

      const choices = ['A','B','C','D'];
      const counts  = { A:0, B:0, C:0, D:0 };

      function resizeCanvasToDisplaySize() {
        const ratio = Math.max(1, Math.floor(window.devicePixelRatio || 1));
        const rect = pollCanvas.getBoundingClientRect();
        const displayWidth  = Math.max(300, Math.floor(rect.width || pollCanvas.clientWidth || 300));
        const displayHeight = Math.max(180, Math.floor(rect.height || pollCanvas.clientHeight || 200));

        if (pollCanvas.width !== displayWidth * ratio || pollCanvas.height !== displayHeight * ratio) {
          pollCanvas.width  = displayWidth * ratio;
          pollCanvas.height = displayHeight * ratio;
        }
        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
        return { width: displayWidth, height: displayHeight };
      }

      function drawPoll(){
        const { width, height } = resizeCanvasToDisplaySize();
        ctx.clearRect(0,0,width,height);

        // Axes
        ctx.strokeStyle = '#666';
        ctx.beginPath();
        const originX = 40, originY = height - 30;
        ctx.moveTo(originX, 10); ctx.lineTo(originX, originY); ctx.lineTo(width-10, originY); ctx.stroke();

        // Bars
        const max = Math.max(1, ...Object.values(counts));
        const barW = (width - 80) / choices.length;

        choices.forEach((label, idx) => {
          const val = counts[label];
          const h   = Math.round(((height - 60) * val) / max);
          const x   = 50 + idx * barW + 10;
          const y   = originY - h;

          ctx.fillStyle = '#ddd';
          ctx.fillRect(x, y, barW - 20, h);

          ctx.fillStyle = '#aaa';
          ctx.textAlign = 'center';
          // Category + value
          ctx.fillText(label, x + (barW - 20)/2, originY + 14);
          ctx.fillText(String(val), x + (barW - 20)/2, y - 6);
        });
      }

      // Votes
      document.querySelectorAll('.poll button[data-choice]').forEach(btn => {
        btn.addEventListener('click', () => { counts[btn.dataset.choice]++; drawPoll(); });
      });

      // Reset
      document.getElementById('resetPoll').addEventListener('click', () => {
        choices.forEach(k => counts[k] = 0); drawPoll();
      });

      // Redraw when sizes change
      window.addEventListener('resize', drawPoll);
      if ('ResizeObserver' in window) {
        new ResizeObserver(drawPoll).observe(pollCanvas);
      }

      // Draw at the right moment
      const start = () => drawPoll();
      if (window.Reveal && typeof Reveal.on === 'function') {
        Reveal.on('ready', start);
        Reveal.on('slidechanged', start);
      } else {
        // Fallback if Reveal isn’t there
        window.addEventListener('load', start);
        document.addEventListener('DOMContentLoaded', start);
        // Also call once immediately (covers most cases)
        start();
      }
    })();
  </script>
</body>
</html>
